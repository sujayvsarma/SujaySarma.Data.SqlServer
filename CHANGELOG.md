Change log
---

*This document captures all changes made to this library since it's initial release.*

### Version 8.9.7 (Latest!)

- Addresses a security vulnerability in Microsoft.Data.SqlClient v5.1.2 that was used till the previous version of this library. To mitigate, we have a simple update to the latest (5.1.5) version of the Microsoft library.
(There are no other changes in this version!) 

### Version 8.9.6

- Adds support to .NET 6.0+


### Version 8.9.0

- Adds two methods to SqlTableContext: `EnableDebugging()` and `DisableDebugging()`. Simply call this on your instance of `SqlTableContext` to enable/disable T-SQL dumping to console/logs. The functions are available in both DEBUG and RELEASE versions. However, SQL-dumps will be output only in DEBUG mode.

    Example:
    ```
    SqlTableContext tableContext = new();
    tableContext.EnableDebugging();
    //... do something ...
    tableContext.DisableDebugging();
    ```

- Fixes a bug in SqlTableContext's InsertAsync, UpdateAsync and DeleteAsync operations where passing an empty structure still causes a connection to be set up. Now, we detect the empty structure early and exit the operation with a Zero (0) return.

- Fixes expression parsing bugs:

     - Expressions like `== null` and `<> null` are correctly parsed to `IS NULL` and `IS NOT NULL`.
     
     - Linq method `Contains()` will now correctly parse to a T-SQL `IN` operation.

### Version 8.8.5

- Fixes a few bugs. 
    - Query builders will now correctly pick up table and column specifications when they are class-inherited instead of being directly on the operated object.

- Allows chaning `Join`, `Where` and `OrderBy` clauses (eg: `qb.Where.Add().Add().Add()`). Earlier, each `Add()` would need to be a fresh statement.

- It is no longer necessary to include a call to `qb.Select<T>()` only to add columns to the generated `SELECT` query. If the `Select<T>()` call is not performed, `Build()` will automatically add all columns from the object/table specified in the initial `From<T>()` call.
 
### Version 8.8.0

- Adds Lambda Expression support. Use this with the Fluid style statement builders.

- New! In the namespace `SujaySarma.Data.SqlServer.Fluid`, find new statement builders:

    - SqlQueryBuilder
    - SqlInsertBuilder
    - SqlInsertFromQueryBuilder
    - SqlUpdateBuilder
    - SqlUpdateWithJoinsBuilder
    - SqlDeleteBuilder
   
    details of how to use these are in [this document](https://github.com/sujayvsarma/SujaySarma.Data.SqlServer/blob/master/_docs/FLUID.md).

### Version 8.7.5

- Fixes a bug that incorrectly evaluated `null` values in the `ExecuteScalarAsync()` method. This bug fix has no impact on code.


### Version 8.7.0

- Mitigates a SQL Injection in all variations of the `Select()` methods.

  Internal modification to the code in these methods now use a `SqlCommand` object to execute queries rather than preparing raw SQL queries. 
  This method also ensures that filters and other parameters are added to the SqlCommand properly rather than use (dangerous) string concatenation.

- Adds new `Select()` overload that accepts a pre-prepared `SqlCommand`.

  New overloads have been added to the `Select()` methods that accept a `SqlCommand` parameter instead of the other parameter lists. This makes it easier 
  to pass in complex queries in a safe manner.

### Version 8.5.0

- Added `UpsertAsync()` to support the SQL `MERGE` operation.

  Make use of the new method to perform Upsert (*Update if exists, Insert if not*) operations on SQL tables.

- Added support to dump generated SQL to Console for troubleshooting.

  Sometimes it may be difficult to identify why a certain operation failed or is producing unexpected results. Since the library prepares SQL commands and fires them 
  at the SQL Server, the only option prior to this version was to debug the SQL Server using the SQL Profiler tool. Starting with this version, developers can set 
  an environment variable named `SQLTABLECONTEXT_DUMPSQL` and all SQL generated by this library will be written to the active Console.

  The variable may be set either in the project properties or the server's Environment Variables or through code. We recommend setting and then unsetting the 
  variable exactly around the workflow you want to troubleshoot to avoid capturing sensitive information.
 
  **NOTE:** The library will dump SQL *only* if the code has been compiled in `DEBUG` mode.

  ```
    // set the variable
	Environment.SetEnvironmentVariable("SQLTABLECONTEXT_DUMPSQL", "true");

    // this is the part we want to troubleshoot
    await tableContext.UpsertAsync(objects);

    // remove the variable
    Environment.SetEnvironmentVariable("SQLTABLECONTEXT_DUMPSQL", null);
  ```

### Version 8.2.0

- Adds `ExecuteStoredProcedure()` method.

  Use this new method to execute Stored Procedures (and Functions) on your SQL Server target. We have also added a new return type `StoredProcedureExecutionResult` 
  that returns rich information from this method.
 

### Version 8.0.0

This is the initial release of the library.
